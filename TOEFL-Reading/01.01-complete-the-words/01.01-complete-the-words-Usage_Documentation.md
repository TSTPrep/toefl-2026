# TOEFL 2026 - Complete the Words - Passage Generator Usage Documentation

## Introduction
This document provides instructions for installing and using the `01.01-complete-the-words_PassageGenerator.gs` Google Apps Script. This script automates the generation of academic passages for the "Complete the Words" question type, and it is fully configurable through your Google Sheet.

## Installation

1.  **Open Google Sheet**: Open your "TOEFL Reading - Complete the Words - Generation" spreadsheet.
2.  **Open Script Editor**: Go to `Extensions > Apps Script`.
3.  **Create Script File**: If you haven't already, create a new script file named `01.01-complete-the-words_PassageGenerator.gs`.
4.  **Copy Code**: Paste the entire content of the script into this file.
5.  **Save Script**: Click the "Save project" icon.

## Initial Setup: Configuration Sheets

The script is controlled by two dedicated sheets. **It is crucial to set these up correctly.**

### 1. 'Config' Sheet (gid: 188417004)

This sheet is the main control panel. Create a sheet with this exact GID.

**Structure**:
- **Column A**: The configuration key (e.g., `API_KEY`).
- **Column B**: The value for that key.

**Mandatory Setup**:
You must fill out this sheet with all the required keys. This includes your `API_KEY`, AI model settings, and the multi-part prompt. Refer to the main documentation or the `loadConfig` function in the script for the full list of required keys.

### 2. 'Topics' Sheet (gid: 350240275)

This sheet manages the topics for passage generation. Create a sheet with this exact GID.

**Structure**:
- **Column A**: The name of the topic category (e.g., "Natural Sciences & Environment").
- **Column B**: A single cell containing all topics for that category, formatted as a comma-separated list of double-quoted strings.

**Example**:
`"Fossil fuels and their formation", "Renewable energy (solar, wind, hydro)", "Earthâ€™s layers: crust, mantle, core"`

## Usage

Once the script is installed and the configuration sheets are set up, a custom menu will appear in your Google Sheet.

### Custom Menu: `TOEFL 2026 Generator`

- **Refresh the Sheet**: If the menu doesn't appear, refresh your Google Sheet tab.
- **Location**: The menu will be at the top, next to "Help".

### Generating Passages

The script uses a designated "output" sheet where the generated passages will be written. You can control the generation process using cells in this output sheet.

**Control Cells (in your chosen output sheet)**:
*   **Cell A1 (Topic Selection Mode)**:
    *   `All Random`: Selects a topic randomly from all categories in the 'Topics' sheet.
    *   `Category Random`: Selects a topic from the specific category named in cell A2.
    *   `Specific Topic`: Uses the exact topic written in cell A3.
*   **Cell A2 (Category Selection)**: The category name to use for `Category Random` mode.
*   **Cell A3 (Specific Topic)**: The specific topic to use for `Specific Topic` mode.
*   **Cell B1 (Batch Size)**: The number of passages to create when you run the batch command.
*   **Cell C1 (Start Output Row)**: The first row where the script will start writing passages.

**Menu Commands**:
1.  **Generate Single Passage**:
    *   Select `TOEFL 2026 Generator > Generate Single Passage`.
    *   The script will generate one passage based on your control cell settings and write it to the next available row.
2.  **Start Batch Process**:
    *   Select `TOEFL 2026 Generator > Start Batch Process`.
    *   This will kick off a background process that generates a chunk of up to 10 passages every minute, until the total number specified in cell B1 is reached.
    *   You can safely close the sheet, and the process will continue to run in the background.
3.  **Stop Batch Process**:
    *   Select `TOEFL 2026 Generator > Stop Batch Process`.
    *   This will immediately stop the current batch process and prevent any more passages from being generated.

## Troubleshooting

*   **Errors / Script Not Working**:
    *   **Check GIDs**: Ensure your 'Config' and 'Topics' sheets have the correct GIDs (`188417004` and `350240275`).
    *   **Check Config Keys**: Make sure all required keys are present in your 'Config' sheet and spelled correctly.
    *   **Check API Key**: Verify that the `API_KEY` in your 'Config' sheet is correct and has API access.
*   **Menu Not Appearing**: Save the script in the Apps Script editor and refresh your Google Sheet.
*   **Passage Generation Failures**: Use the Apps Script editor's `Execution log` to see detailed error messages from the script or the OpenAI API.
*   **Batch Process Not Running**: Check the "Triggers" section in the Apps Script editor to ensure that a trigger for `processSingleBatchItem` has been created.
